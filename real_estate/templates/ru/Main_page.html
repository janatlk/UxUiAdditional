{% extends 'ru/navbar.html' %}
{% load static %}
{% block head %}
<link rel="stylesheet" href="{% static 'real_estate/css/main_page.css' %}">
{% endblock %}

{% block content %}
<div class="ui container" style="display: flex; gap: 30px; margin-top: 20px;">

    <form method="get" action="{% url 'main_page' %}" class="ui vertical form" style="width: 300px;">
        <h3 class="ui header">Фильтры</h3>

        <!-- Компания -->
        <div class="field">
            <label>Компания</label>
            <select name="company" class="ui dropdown">
                <option value="">Все компании</option>
                {% for company in companies %}
                    <option value="{{ company.id }}" {% if filters.company == company.id|stringformat:"s" %}selected{% endif %}>
                        {{ company.title }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Местоположение -->
        <div class="field">
            <label>Местоположение</label>
            <select name="location" class="ui dropdown">
                <option value="">Все локации</option>
                {% for loc in locations %}
                    <option value="{{ loc }}" {% if filters.location == loc %}selected{% endif %}>{{ loc }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Цена -->
        <div class="two fields">
            <div class="field">
                <label>Минимальная цена</label>
                <input type="number" name="min_price" step="1000" placeholder="Мин" value="{{ filters.min_price }}">
            </div>
            <div class="field">
                <label>Максимальная цена</label>
                <input type="number" name="max_price" step="1000" placeholder="Макс" value="{{ filters.max_price }}">
            </div>
        </div>

        <button class="ui primary button" type="submit">Применить фильтры</button>
        <a href="{% url 'main_page' %}" class="ui button" style="margin-top: 10px;">Сбросить</a>
    </form>

    <div class="ui three stackable cards" style="flex-grow: 1;">
        {% for property in properties %}
        <div class="card">
            <div class="image">
                {% with first_image=property.images.first %}
                    {% if first_image %}
                        <img src="{{ first_image.image.url }}" alt="Фото">
                    {% else %}
                        <img src="/static/no_image.jpg" alt="Нет фото">
                    {% endif %}
                {% endwith %}
            </div>
            <div class="content">
                <div class="header">{{ property.title }}</div>
                <div class="meta">
                    <span class="date">${{ property.price }}</span>
                    <br>
                    <span class="loc2">{{ property.company_linked.title }}</span>
                    <div class="location">
                        <span class="loc"><i>{{ property.location }}</i></span>
                    </div>
                </div>
                <div class="description">
                    <p>{{ property.description }}</p>
                </div>
            </div>
            <div class="dop content">
                <a href="/property/{{ property.id }}">
                    <button class="ui primary button">Подробнее</button>
                </a>
            </div>
        </div>
        {% endfor %}
    </div>

</div>

<script>
    $('.ui.dropdown').dropdown();
</script>
{% endblock %}
